<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Distiller Calc</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, sans-serif;
      margin: 0;
      padding: 16px;
      background: var(--tg-theme-bg-color, #fff);
      color: var(--tg-theme-text-color, #000);
    }

    h2 {
      margin-top: 24px;
    }

    .tabs {
      display: flex;
      gap: 8px;
    }

    .tab {
      flex: 1;
      padding: 10px;
      border-radius: 8px;
      border: none;
      background: #ddd;
      cursor: pointer;
      font-weight: 600;
    }

    .tab.active {
      background: var(--tg-theme-button-color, #2ea6ff);
      color: var(--tg-theme-button-text-color, #fff);
    }

    .calculator {
      display: none;
      margin-top: 16px;
    }

    .calculator.active {
      display: block;
    }

    input {
      width: 100%;
      padding: 12px;
      margin: 6px 0;
      font-size: 16px;
      border-radius: 8px;
      border: 1px solid #ccc;
      box-sizing: border-box;
    }

    button.calc {
      width: 100%;
      padding: 14px;
      margin-top: 12px;
      border: none;
      border-radius: 10px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      background: var(--tg-theme-button-color, #2ea6ff);
      color: var(--tg-theme-button-text-color, #fff);
    }

    .result {
      margin-top: 16px;
      font-size: 20px;
      font-weight: bold;
      text-align: center;
    }

    .overlay {
      min-height: 100vh;
    }

    .error {
  color: #b00020;
  font-size: 16px;
  font-weight: 500;
}

.error s {
  display: block;
  margin-bottom: 6px;
}
    /* –ö–Ω–æ–ø–∫–∞ "–ü–æ–¥–¥–µ—Ä–∂–∞—Ç—å –∞–≤—Ç–æ—Ä–∞" */
.donate-btn {
  width: calc(100% - 32px);
  margin: 16px auto 10px auto;
  padding: 16px;
  background: linear-gradient(90deg, #f44336, #e91e63);
  color: white;
  border: none;
  border-radius: 12px;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  transition: opacity 0.3s ease;
}

.donate-btn:active {
  opacity: 0.8;
}

/* –°–∫—Ä—ã—Ç–∏–µ –∫–Ω–æ–ø–∫–∏ –ø—Ä–∏ —Ñ–æ–∫—É—Å–µ –Ω–∞ input */
.donate-btn.hidden {
  display: none !important;
}

/* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */
.modal {
  display: none;
  position: fixed;
  z-index: 1000;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.6);
  animation: fadeIn 0.3s ease;
}

.modal.show {
  display: flex;
  align-items: center;
  justify-content: center;
}

.modal-content {
  background-color: var(--tg-theme-bg-color, #fff);
  width: 90%;
  max-width: 400px;
  max-height: 90vh;
  border-radius: 16px;
  overflow: hidden;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
}

.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 16px 20px;
  border-bottom: 1px solid rgba(128, 128, 128, 0.2);
}

.modal-header h2 {
  margin: 0;
  font-size: 20px;
  font-weight: 600;
}

.close {
  font-size: 28px;
  font-weight: bold;
  color: #999;
  cursor: pointer;
  line-height: 1;
  user-select: none;
}

.close:active {
  color: #666;
}

.modal-body {
  padding: 20px;
  text-align: center;
  overflow-y: auto;
  max-height: calc(90vh - 60px);
}

.donation-icon {
  font-size: 50px;
  margin-bottom: 12px;
}

.donation-subtitle {
  font-size: 16px;
  color: #666;
  margin-bottom: 20px;
}

.qr-container {
  margin: 20px 0;
}

.qr-code {
  width: 100%;
  max-width: 250px;
  height: auto;
  border-radius: 12px;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
}

.qr-caption {
  font-size: 12px;
  color: #999;
  margin-top: 12px;
}

.browser-btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  width: 100%;
  padding: 14px;
  margin: 20px 0 10px 0;
  background: linear-gradient(90deg, #2196F3, #9C27B0);
  color: white;
  text-decoration: none;
  border-radius: 12px;
  font-size: 16px;
  font-weight: 600;
  transition: opacity 0.3s;
  box-sizing: border-box;
}

.browser-btn:active {
  opacity: 0.8;
}

.donation-footer {
  margin-top: 10px;
}

.donation-footer p {
  margin: 6px 0;
  font-size: 13px;
  color: #666;
}

.donation-footer .small-text {
  font-size: 11px;
  color: #999;
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}
  </style>
</head>

<body>
<div class="overlay" onclick="hideKeyboard(event)">

  <div class="tabs">
    <button class="tab active" onclick="showCalc('dilution')">–†–∞–∑–±–∞–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Ä—Ç–∞ –≤–æ–¥–æ–π</button>
    <button class="tab" onclick="showCalc('mixing')">–°–º–µ—à–µ–Ω–∏–µ —Å–ø–∏—Ä—Ç–æ–≤</button>
    <button class="tab" onclick="showCalc('areometer')">–ö–∞–ª–∏–±—Ä–æ–≤–∫–∞ –∞—Ä–µ–æ–º–µ—Ç—Ä–∞</button>
  </div>

  <!-- –†–∞–∑–±–∞–≤–ª–µ–Ω–∏–µ -->
  <div id="dilution" class="calculator active">
    <h2>–†–∞–∑–±–∞–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Ä—Ç–∞ –≤–æ–¥–æ–π</h2>

    <input id="d_v1" placeholder="–û–±—ä—ë–º —Å–ø–∏—Ä—Ç–∞, –ª" type="text" inputmode="decimal">
    <input id="d_c1" placeholder="–ù–∞—á–∞–ª—å–Ω–∞—è –∫—Ä–µ–ø–æ—Å—Ç—å, ¬∞" type="text" inputmode="decimal">
    <input id="d_c2" placeholder="–¢—Ä–µ–±—É–µ–º–∞—è –∫—Ä–µ–ø–æ—Å—Ç—å, ¬∞" type="text" inputmode="decimal">

    <button class="calc" onclick="calcDilution()">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å</button>
    <div id="d_result" class="result"></div>
  </div>

  <!-- –°–º–µ—à–µ–Ω–∏–µ -->
  <div id="mixing" class="calculator">
    <h2>–°–º–µ—à–µ–Ω–∏–µ —Å–ø–∏—Ä—Ç–æ–≤</h2>

    <input id="m_v1" placeholder="–û–±—ä—ë–º —Å–ø–∏—Ä—Ç–∞ 1, –ª" type="text" inputmode="decimal">
    <input id="m_c1" placeholder="–ö—Ä–µ–ø–æ—Å—Ç—å —Å–ø–∏—Ä—Ç–∞ 1, ¬∞" type="text" inputmode="decimal">
    <input id="m_v2" placeholder="–û–±—ä—ë–º —Å–ø–∏—Ä—Ç–∞ 2, –ª" type="text" inputmode="decimal">
    <input id="m_c2" placeholder="–ö—Ä–µ–ø–æ—Å—Ç—å —Å–ø–∏—Ä—Ç–∞ 2, ¬∞" type="text" inputmode="decimal">

    <button class="calc" onclick="calcMixing()">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å</button>
    <div id="m_result" class="result"></div>
  </div>

  <!-- –ê—Ä–µ–æ–º–µ—Ç—Ä -->
  <div id="areometer" class="calculator">
    <h2>–ö–∞–ª–∏–±—Ä–æ–≤–∫–∞ –∞—Ä–µ–æ–º–µ—Ç—Ä–∞</h2>

    <input id="a_t" placeholder="–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –≤ –ø–æ–º–µ—â–µ–Ω–∏–∏, ¬∞C" type="text" inputmode="decimal">
    <input id="a_c" placeholder="–ü–æ–∫–∞–∑–∞–Ω–∏–µ –∞—Ä–µ–æ–º–µ—Ç—Ä–∞" type="text" inputmode="decimal">

    <button class="calc" onclick="calcAreometer()">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å</button>
    <div id="a_result" class="result"></div>
  </div>
<!-- –ö–Ω–æ–ø–∫–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ -->
  <button id="donateBtn" class="donate-btn" onclick="openDonation()">
    ‚ù§Ô∏è –ü–æ–¥–¥–µ—Ä–∂–∞—Ç—å –∞–≤—Ç–æ—Ä–∞
  </button>
  
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–Ω–∞—Ç–∞ (–ü–û–°–õ–ï overlay, –ø–µ—Ä–µ–¥ </body>) -->
<div id="donationModal" class="modal" onclick="closeOnOutside(event)">
  <div class="modal-content">
    <div class="modal-header">
      <h2>–ü–æ–¥–¥–µ—Ä–∂–∞—Ç—å –∞–≤—Ç–æ—Ä–∞</h2>
      <span class="close" onclick="closeDonation()">&times;</span>
    </div>
    
    <div class="modal-body">
      <div class="donation-icon">‚ù§Ô∏è</div>
      <p class="donation-subtitle">–õ—é–±–æ–π –¥–æ–Ω–∞—Ç ‚Äì –∞–≤—Ç–æ—Ä —Ä–∞–¥</p>
      
      <!-- QR-–∫–æ–¥ -->
      <div class="qr-container">
        <img src="donation-qr.jpg" alt="QR –∫–æ–¥ –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ" class="qr-code">
        <p class="qr-caption">–û—Ç—Å–∫–∞–Ω–∏—Ä—É–π—Ç–µ QR-–∫–æ–¥ –¥–ª—è –æ–ø–ª–∞—Ç—ã</p>
      </div>
      
      <!-- –ö–Ω–æ–ø–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è –≤ –±—Ä–∞—É–∑–µ—Ä–µ -->
      <a href="https://tiny.keepz.me/khtc296w" target="_blank" class="browser-btn" onclick="closeDonation()">
        üåê –û—Ç–∫—Ä—ã—Ç—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ
      </a>
      </div>
    </div>
  </div>
</div>

<script>

  // === –õ–û–ì–ò–ö–ê –î–û–ù–ê–¢–ê ===
  
  // –û—Ç–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
  function openDonation() {
    const modal = document.getElementById('donationModal');
    modal.classList.add('show');
    document.body.style.overflow = 'hidden';
    
    if (tg && tg.HapticFeedback) {
      tg.HapticFeedback.impactOccurred('medium');
    }
  }
  
  // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
  function closeDonation() {
    const modal = document.getElementById('donationModal');
    modal.classList.remove('show');
    document.body.style.overflow = '';
  }
  
  // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
  function closeOnOutside(e) {
    if (e.target.id === 'donationModal') {
      closeDonation();
    }
  }
  
  // –°–∫—Ä—ã—Ç–∏–µ –∫–Ω–æ–ø–∫–∏ –¥–æ–Ω–∞—Ç–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–æ–π –∫–ª–∞–≤–∏–∞—Ç—É—Ä–µ
  document.addEventListener('DOMContentLoaded', function() {
    const donateBtn = document.getElementById('donateBtn');
    const inputs = document.querySelectorAll('input');
    
    inputs.forEach(input => {
      input.addEventListener('focus', function() {
        donateBtn.classList.add('hidden');
      });
      
      input.addEventListener('blur', function() {
        setTimeout(() => {
          if (!document.activeElement || document.activeElement.tagName !== 'INPUT') {
            donateBtn.classList.remove('hidden');
          }
        }, 100);
      });
    });
  });
  
</script>

<script>
  const tg = window.Telegram.WebApp;
  tg.expand();

  function parseNumber(v) {
    if (!v) return NaN;
    return parseFloat(v.replace(',', '.'));
  }

  function showCalc(id) {
    document.querySelectorAll('.calculator').forEach(c => c.classList.remove('active'));
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));

    document.getElementById(id).classList.add('active');
    event.target.classList.add('active');
  }

  function hideKeyboard(e) {
    if (e.target.tagName !== 'INPUT') {
      document.activeElement.blur();
    }
  }

  // –†–∞–∑–±–∞–≤–ª–µ–Ω–∏–µ
  function calcDilution() {
    const v1 = parseNumber(d_v1.value);
    const c1 = parseNumber(d_c1.value);
    const c2 = parseNumber(d_c2.value);

    if (!v1 || !c1 || !c2 || c2 <= 0) {
      d_result.innerText = '–û—à–∏–±–∫–∞ –≤–≤–æ–¥–∞';
      return;
    }

    const water = v1 * (c1 - c2) / c2;
    d_result.innerText = `–î–æ–±–∞–≤–∏—Ç—å –≤–æ–¥—ã: ${water.toFixed(2)} –ª`;
  }

  // –°–º–µ—à–µ–Ω–∏–µ
  function calcMixing() {
  const v1 = parseNumber(m_v1.value);
  const c1 = parseNumber(m_c1.value);
  const v2 = parseNumber(m_v2.value);
  const c2 = parseNumber(m_c2.value);

  // –±–∞–∑–æ–≤–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è
  if (isNaN(v1) || isNaN(c1) || isNaN(v2) || isNaN(c2) || v1 + v2 === 0) {
    m_result.innerText = '–û—à–∏–±–∫–∞ –≤–≤–æ–¥–∞';
    return;
  }

  // ‚ùó –ø–æ–ø—ã—Ç–∫–∞ —Å–º–µ—à–∞—Ç—å —Å–ø–∏—Ä—Ç —Å –≤–æ–¥–æ–π
  if (c1 === 0 || c2 === 0) {
    m_result.innerHTML = `
      <div class="error">
        <s>–ù—É –∫—É–¥–∞ —Ç—ã –≤–æ–¥—É –ª–∏—Ç—å —Å–æ–±—Ä–∞–ª—Å—è!</s>
        –î–∞–Ω–Ω—ã–π —Ä–∞—Å—á–µ—Ç –º–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Å—Ç–∏ –≤ —Ä–∞–∑–¥–µ–ª–µ ¬´–†–∞–∑–±–∞–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Ä—Ç–∞ –≤–æ–¥–æ–π¬ª
      </div>
    `;
    return;
  }

  const strength = (v1 * c1 + v2 * c2) / (v1 + v2);
  m_result.innerText = `–ö—Ä–µ–ø–æ—Å—Ç—å: ${strength.toFixed(2)} %`;
}

  // –ê—Ä–µ–æ–º–µ—Ç—Ä
  function calcAreometer() {
    const t = parseNumber(a_t.value);
    const c = parseNumber(a_c.value);

    if (isNaN(t) || isNaN(c)) {
      a_result.innerText = '–û—à–∏–±–∫–∞ –≤–≤–æ–¥–∞';
      return;
    }

    let k = c < 40 ? 0.3 : c < 60 ? 0.35 : 0.4;
    const real = Math.min(100, Math.max(0, c + (t - 20) * k));

    a_result.innerText = `–†–µ–∞–ª—å–Ω–∞—è –∫—Ä–µ–ø–æ—Å—Ç—å: ${real.toFixed(2)} %`;
  }
</script>
</body>
</html>
